/**
 * Imperium 4X (Web) - Game Service
 * ===
 *
 * @module gameService
 */

////////////////////////////////////////////////////////////////////////////////
// Imports
////////////////////////////////////////////////////////////////////////////////
import AjaxService from '../../../../shared/src/services/ajax-service';
import GameModel from '../models/game-model';

////////////////////////////////////////////////////////////////////////////////
// Definitions
////////////////////////////////////////////////////////////////////////////////
const API = 'http://localhost:3099';
const RESOURCE = '/games';

////////////////////////////////////////////////////////////////////////////////
// Class
////////////////////////////////////////////////////////////////////////////////
class GameService {

  //////////////////////////////////////////////////////////////////////////////
  // Private Properties
  //////////////////////////////////////////////////////////////////////////////
  _ajaxService;

  //////////////////////////////////////////////////////////////////////////////
  // Public Properties
  //////////////////////////////////////////////////////////////////////////////

  constructor(){
    this._ajaxService = new AjaxService();
    this.createGame();
  }

  //////////////////////////////////////////////////////////////////////////////
  // Public Methods
  //////////////////////////////////////////////////////////////////////////////
  createGame(){
    //let id = Guid.create();
    //console.log(id);
    //window.history.pushState(null, null, '/' + id);
    let options = {
      url: API + RESOURCE,
      headers: this._buildHeaders()
    };

    return this._ajaxService.post(options)
      .then((data) => {
        let game = JSON.parse(data.responseText);
        return GameModel.create(game);
      }).catch((err) => {
      console.log(err);
    });
  }

  getGameList(){
    let options = {
      url: API + RESOURCE,
      headers: this._buildHeaders()
    };

    return this._ajaxService.get(options);
  }

  getGame(){
    let options = {
      url: API + RESOURCE + this._parseUrl(),
      headers: this._buildHeaders()
    };

    return this._ajaxService.get(options);
  }

  updateGame(){

  }

  //////////////////////////////////////////////////////////////////////////////
  // Private Methods
  //////////////////////////////////////////////////////////////////////////////
  _parseUrl(){
    let pathname = window.location.pathname;
    let parts = pathname.split('/');
    console.log(parts[1]);
  }

  _buildHeaders(token){
    let headers = {
      'Content-Type': 'application/json',
      'Accept': 'application/json',
      'Authorization': 'Bearer ' + token
    };
    return headers;
  }
}

////////////////////////////////////////////////////////////////////////////////
// Exports
////////////////////////////////////////////////////////////////////////////////
export default GameService;